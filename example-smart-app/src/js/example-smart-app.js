var careGapJSON = JSON.parse('{"list":[{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"AMB","rateName":"Outpatient Visits","tinName":"Derry Medical Center","new":false,"rate":"AMBOV","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Ambulatory Care"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"DAE","rateName":"One drug","tinName":"Derry Medical Center","new":false,"rate":"DAE1","pcp_name":"JONATHAN KILROY","careSubMeasure":"MEDMANAG","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"ECM","measureName":"Use of High-Risk Medications in the Elderly"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"DAE","rateName":"Two or more drugs","tinName":"Derry Medical Center","new":false,"rate":"DAE2","pcp_name":"JONATHAN KILROY","careSubMeasure":"MEDMANAG","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"ECM","measureName":"Use of High-Risk Medications in the Elderly"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"ENP","rateName":"N/A","tinName":"Derry Medical Center","new":false,"rate":"N/A","pcp_name":"JONATHAN KILROY","careSubMeasure":"0","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"HPDI","measureName":"Enrollment by Product Line"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"IAD","rateName":"Ambulatory Visits","tinName":"Derry Medical Center","new":false,"rate":"IADAMB","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Identification of Alcohol and Other Drug Services"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"IAD","rateName":"Any service","tinName":"Derry Medical Center","new":false,"rate":"IADANY","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Identification of Alcohol and Other Drug Services"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"IAD","rateName":"Day/Night Visits","tinName":"Derry Medical Center","new":false,"rate":"IADDAY","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Identification of Alcohol and Other Drug Services"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"IAD","rateName":"Inpatient Stays","tinName":"Derry Medical Center","new":false,"rate":"IADINP","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Identification of Alcohol and Other Drug Services"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"MPT","rateName":"Ambulatory Visits","tinName":"Derry Medical Center","new":false,"rate":"MPTAMB","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Mental Health Utilization"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"MPT","rateName":"Any visit","tinName":"Derry Medical Center","new":false,"rate":"MPTANY","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Mental Health Utilization"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"MPT","rateName":"Intermediate (Day/Night) Visits","tinName":"Derry Medical Center","new":false,"rate":"MPTDAY","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Mental Health Utilization"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"MPT","rateName":"Inpatient Stays","tinName":"Derry Medical Center","new":false,"rate":"MPTINP","pcp_name":"JONATHAN KILROY","careSubMeasure":"UTILIZATION","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"URRU","measureName":"Mental Health Utilization"},{"hicNo":"131242377A ","standard":"HEDIS","cachedModel":false,"mrn":"5348660","dateYear":2017,"escapedModel":null,"tin":"20314077","measureId":"PSA","rateName":"N/A","tinName":"Derry Medical Center","new":false,"rate":"N/A","pcp_name":"JONATHAN KILROY","careSubMeasure":"OVERUSE/APP","dob":"1917-08-18","gender":"F","fullName":"CARMEN   ACEVEDO ","careMeasure":"ECM","measureName":"NON-RECOMMENDED PSA-BASED SCREENING IN OLDER MEN"}]}');
var rxJSON = JSON.parse('{"list":[{"lastName":"DONO","datsSupply":50,"cachedModel":false,"strength":"45","npi":"1013245240","drugName":"LEVALBUTEROL TARTRATE","dosage":"AEROSOL, METERED","tradeName":"Xopenex HFA","provider":"DONO, EMMA<br>Speciality: Physician Assistant","escapedModel":null,"orgName":"","units":"ug/1","drugClass":"","new":false,"fromDate":"2017-06-01","rxId":247657,"route":"ORAL","description":"Physician Assistant","quantity":45,"drug_name":"Xopenex HFA - LEVALBUTEROL TARTRATE","pharmClass":"Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"EMMA","ndcCd":"63402051001"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":null,"npi":"1578534806","drugName":"NDC: 68645051554","dosage":null,"tradeName":"N/A","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":null,"drugClass":"","new":false,"fromDate":"2017-05-31","rxId":247655,"route":"N/A","description":"Physician/Family Practice","quantity":90,"drug_name":"N/A - NDC: 68645051554","pharmClass":null,"firstName":"JONATHAN","ndcCd":"68645051554"},{"lastName":"DONO","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1013245240","drugName":"MONTELUKAST SODIUM","dosage":"TABLET, FILM COATED","tradeName":"Montelukast","provider":"DONO, EMMA<br>Speciality: Physician Assistant","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Leukotriene Modifiers","new":false,"fromDate":"2017-05-31","rxId":247656,"route":"ORAL","description":"Physician Assistant","quantity":90,"drug_name":"Montelukast - MONTELUKAST SODIUM","pharmClass":"Leukotriene Receptor Antagonist [EPC],Leukotriene Receptor Antagonists [MoA]","firstName":"EMMA","ndcCd":"31722072690"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"12.5","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2017-05-31","rxId":247658,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"16729018201"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2017-05-05","rxId":225486,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2017-04-17","rxId":218250,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":30.6,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"EZETIMIBE","dosage":"TABLET","tradeName":"Zetia","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Cholesterol Absorption Inhibitors","new":false,"fromDate":"2017-03-27","rxId":208850,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Zetia - EZETIMIBE","pharmClass":"Decreased Cholesterol Absorption [PE],Dietary Cholesterol Absorption Inhibitor [EPC]","firstName":"JONATHAN","ndcCd":"66582041454"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2017-03-08","rxId":198157,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"12.5","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2017-03-08","rxId":198176,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"16729018201"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":null,"npi":"1578534806","drugName":"NDC: 68645051554","dosage":null,"tradeName":"N/A","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":null,"drugClass":"","new":false,"fromDate":"2017-03-03","rxId":195851,"route":"N/A","description":"Physician/Family Practice","quantity":90,"drug_name":"N/A - NDC: 68645051554","pharmClass":null,"firstName":"JONATHAN","ndcCd":"68645051554"},{"lastName":"DONO","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1013245240","drugName":"MONTELUKAST SODIUM","dosage":"TABLET, FILM COATED","tradeName":"Montelukast Sodium","provider":"DONO, EMMA<br>Speciality: Physician Assistant","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"","new":false,"fromDate":"2017-02-17","rxId":195933,"route":"ORAL","description":"Physician Assistant","quantity":90,"drug_name":"Montelukast Sodium","pharmClass":"Leukotriene Receptor Antagonist [EPC],Leukotriene Receptor Antagonists [MoA]","firstName":"EMMA","ndcCd":"68645052801"},{"lastName":"DONO","datsSupply":50,"cachedModel":false,"strength":"45","npi":"1013245240","drugName":"LEVALBUTEROL TARTRATE","dosage":"AEROSOL, METERED","tradeName":"Xopenex HFA","provider":"DONO, EMMA<br>Speciality: Physician Assistant","escapedModel":null,"orgName":"","units":"ug/1","drugClass":"","new":false,"fromDate":"2017-02-17","rxId":195934,"route":"ORAL","description":"Physician Assistant","quantity":45,"drug_name":"Xopenex HFA - LEVALBUTEROL TARTRATE","pharmClass":"Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"EMMA","ndcCd":"63402051001"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2017-02-04","rxId":195930,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2017-01-22","rxId":195932,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":30.6,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":33,"cachedModel":false,"strength":"45","npi":"1578534806","drugName":"LEVALBUTEROL TARTRATE","dosage":"AEROSOL, METERED","tradeName":"Xopenex HFA","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1","drugClass":"","new":false,"fromDate":"2017-01-10","rxId":195931,"route":"ORAL","description":"Physician/Family Practice","quantity":30,"drug_name":"Xopenex HFA - LEVALBUTEROL TARTRATE","pharmClass":"Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"63402051001"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2017-01-02","rxId":195929,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"EZETIMIBE","dosage":"TABLET","tradeName":"Zetia","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Cholesterol Absorption Inhibitors","new":false,"fromDate":"2016-12-28","rxId":163056,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Zetia - EZETIMIBE","pharmClass":"Decreased Cholesterol Absorption [PE],Dietary Cholesterol Absorption Inhibitor [EPC]","firstName":"JONATHAN","ndcCd":"66582041431"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2016-12-03","rxId":146529,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"25","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2016-11-28","rxId":146543,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"68645051070"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"MONTELUKAST SODIUM","dosage":"TABLET, FILM COATED","tradeName":"Montelukast","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Leukotriene Modifiers","new":false,"fromDate":"2016-11-28","rxId":146544,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Montelukast - MONTELUKAST SODIUM","pharmClass":"Leukotriene Receptor Antagonist [EPC],Leukotriene Receptor Antagonists [MoA]","firstName":"JONATHAN","ndcCd":"54458089010"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-11-11","rxId":135064,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":30.6,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2016-10-11","rxId":121246,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"EZETIMIBE","dosage":"TABLET","tradeName":"Zetia","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Cholesterol Absorption Inhibitors","new":false,"fromDate":"2016-10-01","rxId":108295,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Zetia - EZETIMIBE","pharmClass":"Decreased Cholesterol Absorption [PE],Dietary Cholesterol Absorption Inhibitor [EPC]","firstName":"JONATHAN","ndcCd":"66582041431"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"5","npi":"1578534806","drugName":"AMLODIPINE BESYLATE","dosage":"TABLET","tradeName":"Amlodipine Besylate","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Dihydropyridines","new":false,"fromDate":"2016-09-26","rxId":108296,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Amlodipine Besylate","pharmClass":"Calcium Channel Antagonists [MoA],Dihydropyridine Calcium Channel Blocker [EPC],Dihydropyridines [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"69097083705"},{"lastName":"KILROY","datsSupply":33,"cachedModel":false,"strength":"45","npi":"1578534806","drugName":"LEVALBUTEROL TARTRATE","dosage":"AEROSOL, METERED","tradeName":"Xopenex HFA","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1","drugClass":"","new":false,"fromDate":"2016-09-20","rxId":106665,"route":"ORAL","description":"Physician/Family Practice","quantity":30,"drug_name":"Xopenex HFA - LEVALBUTEROL TARTRATE","pharmClass":"Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"63402051001"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-09-18","rxId":106666,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"25","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2016-09-02","rxId":99121,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"23155000810"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"25","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2016-09-02","rxId":99121,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"23155000810"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"MONTELUKAST SODIUM","dosage":"TABLET, FILM COATED","tradeName":"Montelukast Sodium","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Leukotriene Modifiers","new":false,"fromDate":"2016-09-02","rxId":99122,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Montelukast Sodium","pharmClass":"Leukotriene Receptor Antagonist [EPC],Leukotriene Receptor Antagonists [MoA]","firstName":"JONATHAN","ndcCd":"00093742698"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-08-22","rxId":97034,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1578534806","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2016-08-12","rxId":91694,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JONATHAN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-07-29","rxId":83924,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"EZETIMIBE","dosage":"TABLET","tradeName":"Zetia","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Cholesterol Absorption Inhibitors","new":false,"fromDate":"2016-06-30","rxId":73193,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Zetia - EZETIMIBE","pharmClass":"Decreased Cholesterol Absorption [PE],Dietary Cholesterol Absorption Inhibitor [EPC]","firstName":"JONATHAN","ndcCd":"66582041431"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"5","npi":"1578534806","drugName":"AMLODIPINE BESYLATE","dosage":"TABLET","tradeName":"Amlodipine Besylate","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Dihydropyridines","new":false,"fromDate":"2016-06-30","rxId":73194,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Amlodipine Besylate","pharmClass":"Calcium Channel Antagonists [MoA],Dihydropyridine Calcium Channel Blocker [EPC],Dihydropyridines [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"31722023890"},{"lastName":"WHEELER","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1518931146","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"WHEELER, JOHN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2016-06-10","rxId":64203,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JOHN","ndcCd":"53746061701"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"25","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2016-06-01","rxId":61836,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"68645051070"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"MONTELUKAST SODIUM","dosage":"TABLET, FILM COATED","tradeName":"Montelukast Sodium","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Leukotriene Modifiers","new":false,"fromDate":"2016-06-01","rxId":61838,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Montelukast Sodium","pharmClass":"Leukotriene Receptor Antagonist [EPC],Leukotriene Receptor Antagonists [MoA]","firstName":"JONATHAN","ndcCd":"00093742698"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-05-18","rxId":56121,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-04-18","rxId":43947,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"WHEELER","datsSupply":30,"cachedModel":false,"strength":"37.5; 325","npi":"1518931146","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"WHEELER, JOHN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2016-04-12","rxId":40764,"route":"ORAL","description":"Physician/Family Practice","quantity":120,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JOHN","ndcCd":"53746061701"},{"lastName":"WELTER","datsSupply":90,"cachedModel":false,"strength":"5","npi":"1982674503","drugName":"AMLODIPINE BESYLATE","dosage":"TABLET","tradeName":"Amlodipine Besylate","provider":"WELTER, JOHN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Dihydropyridines","new":false,"fromDate":"2016-03-30","rxId":35485,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Amlodipine Besylate","pharmClass":"Calcium Channel Antagonists [MoA],Dihydropyridine Calcium Channel Blocker [EPC],Dihydropyridines [Chemical/Ingredient]","firstName":"JOHN","ndcCd":"31722023890"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"ROSUVASTATIN CALCIUM","dosage":"TABLET, FILM COATED","tradeName":"CRESTOR","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"HMG-CoA Reductase Inhibitors","new":false,"fromDate":"2016-03-30","rxId":35486,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"CRESTOR - ROSUVASTATIN CALCIUM","pharmClass":"HMG-CoA Reductase Inhibitor [EPC],Hydroxymethylglutaryl-CoA Reductase Inhibitors [MoA]","firstName":"JONATHAN","ndcCd":"00310075190"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"EZETIMIBE","dosage":"TABLET","tradeName":"Zetia","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Cholesterol Absorption Inhibitors","new":false,"fromDate":"2016-03-30","rxId":35487,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Zetia - EZETIMIBE","pharmClass":"Decreased Cholesterol Absorption [PE],Dietary Cholesterol Absorption Inhibitor [EPC]","firstName":"JONATHAN","ndcCd":"66582041431"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-03-16","rxId":29920,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"},{"lastName":"KILROY","datsSupply":50,"cachedModel":false,"strength":"45","npi":"1578534806","drugName":"LEVALBUTEROL TARTRATE","dosage":"AEROSOL, METERED","tradeName":"Xopenex HFA","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1","drugClass":"","new":false,"fromDate":"2016-02-29","rxId":24174,"route":"ORAL","description":"Physician/Family Practice","quantity":45,"drug_name":"Xopenex HFA - LEVALBUTEROL TARTRATE","pharmClass":"Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"63402051001"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"25","npi":"1578534806","drugName":"HYDROCHLOROTHIAZIDE","dosage":"TABLET","tradeName":"Hydrochlorothiazide","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Thiazide Diuretics","new":false,"fromDate":"2016-02-27","rxId":21305,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Hydrochlorothiazide","pharmClass":"Increased Diuresis [PE],Thiazide Diuretic [EPC],Thiazides [Chemical/Ingredient]","firstName":"JONATHAN","ndcCd":"68645051070"},{"lastName":"KILROY","datsSupply":90,"cachedModel":false,"strength":"10","npi":"1578534806","drugName":"MONTELUKAST SODIUM","dosage":"TABLET, FILM COATED","tradeName":"Montelukast","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1","drugClass":"Leukotriene Modifiers","new":false,"fromDate":"2016-02-27","rxId":21306,"route":"ORAL","description":"Physician/Family Practice","quantity":90,"drug_name":"Montelukast - MONTELUKAST SODIUM","pharmClass":"Leukotriene Receptor Antagonist [EPC],Leukotriene Receptor Antagonists [MoA]","firstName":"JONATHAN","ndcCd":"54458089010"},{"lastName":"WHEELER","datsSupply":27,"cachedModel":false,"strength":"37.5; 325","npi":"1518931146","drugName":"TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","dosage":"TABLET","tradeName":"Tramadol Hydrochloride and Acetaminophen","provider":"WHEELER, JOHN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"mg/1; mg/1","drugClass":"Opiate Agonists","new":false,"fromDate":"2016-02-16","rxId":18794,"route":"ORAL","description":"Physician/Family Practice","quantity":108,"drug_name":"Tramadol Hydrochloride and Acetaminophen - TRAMADOL HYDROCHLORIDE; ACETAMINOPHEN","pharmClass":"Full Opioid Agonists [MoA],Opioid Agonist [EPC]","firstName":"JOHN","ndcCd":"53746061705"},{"lastName":"KILROY","datsSupply":30,"cachedModel":false,"strength":"160; 4.5","npi":"1578534806","drugName":"BUDESONIDE; FORMOTEROL FUMARATE","dosage":"AEROSOL","tradeName":"SYMBICORT","provider":"KILROY, JONATHAN<br>Speciality: Physician/Family Practice","escapedModel":null,"orgName":"","units":"ug/1; ug/1","drugClass":"Adrenals","new":false,"fromDate":"2016-02-01","rxId":13453,"route":"RESPIRATORY (INHALATION)","description":"Physician/Family Practice","quantity":10.2,"drug_name":"SYMBICORT - BUDESONIDE; FORMOTEROL FUMARATE","pharmClass":"Corticosteroid [EPC],Corticosteroid Hormone Receptor Agonists [MoA],Adrenergic beta2-Agonists [MoA],beta2-Adrenergic Agonist [EPC]","firstName":"JONATHAN","ndcCd":"00186037020"}]}');
var admissionJSON = JSON.parse('{"list":[{"lastName":"GUPTA","thruDate":"2017-03-30","cachedModel":false,"attendingNpi":"1346457926","npi":"1174570683","attendDesc":"GUPTA, SHWETA","provider":"HCA HEALTH SERVICES OF NEW HAMPSHIRE INC","escapedModel":null,"city":"DERRY","new":false,"fromDate":"2017-03-27","stateName":"NH","firstName":"SHWETA"}]}');
var visitsJSON = JSON.parse('{"list":[{"specCd":"08","thruDate":"2017-05-19","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2017-05-19","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2017-05-05","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2017-05-05","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2017-04-10","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2017-04-10","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2017-03-10","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2017-03-10","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2017-02-28","cachedModel":false,"npi":"1346379393","escapedModel":null,"providerLastName":"MURAI","new":false,"posCd":"11","acoId":0,"fromDate":"2017-02-28","hicNum":"001014761A ","providerFirstName":"SARAH","description":"Family Practice","name":"MURAI, SARAH","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2017-01-03","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2017-01-03","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2016-10-04","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2016-10-04","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2016-08-09","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2016-08-09","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2016-04-19","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2016-04-19","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"08","thruDate":"2016-01-19","cachedModel":false,"npi":"1720058944","escapedModel":null,"providerLastName":"DALEY","new":false,"posCd":"11","acoId":0,"fromDate":"2016-01-19","hicNum":"001014761A ","providerFirstName":"JOHN","description":"Family Practice","name":"DALEY, JOHN","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"},{"specCd":"10","thruDate":"2016-01-08","cachedModel":false,"npi":"1154381614","escapedModel":null,"providerLastName":"ROALSVIG","new":false,"posCd":"11","acoId":0,"fromDate":"2016-01-08","hicNum":"001014761A ","providerFirstName":"KNUT","description":"Gastroenterology","name":"ROALSVIG, KNUT","claimTypeCd":"71","providerState":"NH","providerCity":"DERRY"}]}');
var observationJSON = { list: []  };
(function(window){
  window.extractData = function() {
    var ret = $.Deferred();

    function onError() {
      console.log('Loading error', arguments);
      ret.reject();
    }

    function onReady(smart)  {
      if (smart.hasOwnProperty('patient')) {
        console.log(smart);
        var patient = smart.patient;
     
        var pt = patient.read();
        
        var obv = smart.patient.api.fetchAll({
                    type: 'Observation',
                    query: {
                      code: {
                        $or: ['http://loinc.org|8302-2', 'http://loinc.org|8462-4',
                              'http://loinc.org|8480-6', 'http://loinc.org|2085-9',
                              'http://loinc.org|2089-1', 'http://loinc.org|55284-4']
                      }
                    }
                  });
        
        $.when(pt, obv).fail(onError);

        $.when(pt, obv).done(function(patient, obv) {
          var byCodes = smart.byCodes(obv, 'code');
          var gender = patient.gender;
          var dob = new Date(patient.birthDate);
          var day = dob.getDate();
          var monthIndex = dob.getMonth() + 1;
          var year = dob.getFullYear();
          console.log("Patient Obj");
          console.log(patient);
          console.log("Observation");
          console.log(obv);
          
          var dobStr = monthIndex + '/' + day + '/' + year;
          var fname = '';
          var lname = '';

          if (typeof patient.name[0] !== 'undefined') {
            fname = patient.name[0].given.join(' ');
            lname = patient.name[0].family.join(' ');
          }

          var height = byCodes('8302-2');
          var systolicbp = getBloodPressureValue(byCodes('55284-4'),'8480-6');
          var diastolicbp = getBloodPressureValue(byCodes('55284-4'),'8462-4');
          var hdl = byCodes('2085-9');
          var ldl = byCodes('2089-1');

          var p = defaultPatient();
          p.birthdate = dobStr;
          p.gender = gender;
          p.fname = fname;
          p.lname = lname;
          p.id = patient.id;
          p.age = parseInt(calculateAge(dob));
          p.height = getQuantityValueAndUnit(height[0]);
          
          var observationText = "";
          for ( var x = 0 ; x < obv.length; x++ )
          {
            observationText+=obv[x].text.div;
            var observation = { "effectiveDateTime" : "" , "category" : "", "code" : "", "interpretation" : "", "value" : 0, "units":""};
            observation.effectiveDateTime = obv[x].effectiveDateTime;
            observation.code = obv[x].code.text;
            observation.value = obv[x].valueQuantity.value;
            observation.units = obv[x].valueQuantity.units;
            if ( obv[x].category.coding.lenth > 0 )
            {
              observation.category = obv[x].category.coding[0].text;
            }
            if ( typeof obv[x].interpretation != 'undefined' &&  obv[x].interpretation.coding.length > 0 )
            {
              observation.interpretation = obv[x].interpretation.coding[0].display;
            }
            observationJSON.list.push(observation);
                
          }
          
          p.observationText = observationText;

          if (typeof systolicbp != 'undefined')  {
            p.systolicbp = systolicbp;
          }

          if (typeof diastolicbp != 'undefined') {
            p.diastolicbp = diastolicbp;
          }

          p.hdl = getQuantityValueAndUnit(hdl[0]);
          p.ldl = getQuantityValueAndUnit(ldl[0]);

          ret.resolve(p);
        });
      } else {
        onError();
      }
    }

    FHIR.oauth2.ready(onReady, onError);
    return ret.promise();

  };

  function defaultPatient(){
    return {
      id:  {value: ''},
      fname: {value: ''},
      lname: {value: ''},
      gender: {value: ''},
      birthdate: {value: ''},
      age: {value: ''},
      height: {value: ''},
      systolicbp: {value: ''},
      diastolicbp: {value: ''},
      ldl: {value: ''},
      hdl: {value: ''},
      observationText: {value: ''}
    };
  }

  function getBloodPressureValue(BPObservations, typeOfPressure) {
    var formattedBPObservations = [];
    BPObservations.forEach(function(observation){
      var BP = observation.component.find(function(component){
        return component.code.coding.find(function(coding) {
          return coding.code == typeOfPressure;
        });
      });
      if (BP) {
        observation.valueQuantity = BP.valueQuantity;
        formattedBPObservations.push(observation);
      }
    });

    return getQuantityValueAndUnit(formattedBPObservations[0]);
  }

  function isLeapYear(year) {
    return new Date(year, 1, 29).getMonth() === 1;
  }

  function calculateAge(date) {
    if (Object.prototype.toString.call(date) === '[object Date]' && !isNaN(date.getTime())) {
      var d = new Date(date), now = new Date();
      var years = now.getFullYear() - d.getFullYear();
      d.setFullYear(d.getFullYear() + years);
      if (d > now) {
        years--;
        d.setFullYear(d.getFullYear() - 1);
      }
      var days = (now.getTime() - d.getTime()) / (3600 * 24 * 1000);
      return years + days / (isLeapYear(now.getFullYear()) ? 366 : 365);
    }
    else {
      return undefined;
    }
  }

  function getQuantityValueAndUnit(ob) {
    if (typeof ob != 'undefined' &&
        typeof ob.valueQuantity != 'undefined' &&
        typeof ob.valueQuantity.value != 'undefined' &&
        typeof ob.valueQuantity.unit != 'undefined') {
          return ob.valueQuantity.value + ' ' + ob.valueQuantity.unit;
    } else {
      return undefined;
    }
  }

  window.drawVisualization = function(p) {
    $('#holder').show();
    $('#loading').hide();
    $('#id').html(p.id);
    $('#fname').html(p.fname);
    $('#lname').html(p.lname);
    $('#gender').html(p.gender);
    $('#birthdate').html(p.birthdate);
    $('#age').html(p.age);
    //$('#height').html(p.height);
    //$('#systolicbp').html(p.systolicbp);
    //$('#diastolicbp').html(p.diastolicbp);
    //$('#ldl').html(p.ldl);
    //$('#hdl').html(p.hdl);
    //$('#observations').html(p.observationText);
    
    
    
  };

})(window);
